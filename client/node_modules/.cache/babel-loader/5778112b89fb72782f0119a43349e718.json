{"ast":null,"code":"import { PhaseShiftAllpass } from \"../component/filter/PhaseShiftAllpass\";\nimport { optionsFromArguments } from \"../core/util/Defaults\";\nimport { Effect } from \"../effect/Effect\";\nimport { Add } from \"../signal/Add\";\nimport { Multiply } from \"../signal/Multiply\";\nimport { Negate } from \"../signal/Negate\";\nimport { Signal } from \"../signal/Signal\";\nimport { Oscillator } from \"../source/oscillator/Oscillator\";\nimport { ToneOscillatorNode } from \"../source/oscillator/ToneOscillatorNode\";\n/**\n * FrequencyShifter can be used to shift all frequencies of a signal by a fixed amount.\n * The amount can be changed at audio rate and the effect is applied in real time.\n * The frequency shifting is implemented with a technique called single side band modulation using a ring modulator.\n * Note: Contrary to pitch shifting, all frequencies are shifted by the same amount,\n * destroying the harmonic relationship between them. This leads to the classic ring modulator timbre distortion.\n * The algorithm will produces some aliasing towards the high end, especially if your source material\n * contains a lot of high frequencies. Unfortunatelly the webaudio API does not support resampling\n * buffers in real time, so it is not possible to fix it properly. Depending on the use case it might\n * be an option to low pass filter your input before frequency shifting it to get ride of the aliasing.\n * You can find a very detailed description of the algorithm here: https://larzeitlin.github.io/RMFS/\n *\n * @example\n * const input = new Tone.Oscillator(230, \"sawtooth\").start();\n * const shift = new Tone.FrequencyShifter(42).toDestination();\n * input.connect(shift);\n * @category Effect\n */\n\nexport class FrequencyShifter extends Effect {\n  constructor() {\n    super(optionsFromArguments(FrequencyShifter.getDefaults(), arguments, [\"frequency\"]));\n    this.name = \"FrequencyShifter\";\n    const options = optionsFromArguments(FrequencyShifter.getDefaults(), arguments, [\"frequency\"]);\n    this.frequency = new Signal({\n      context: this.context,\n      units: \"frequency\",\n      value: options.frequency,\n      minValue: -this.context.sampleRate / 2,\n      maxValue: this.context.sampleRate / 2\n    });\n    this._sine = new ToneOscillatorNode({\n      context: this.context,\n      type: \"sine\"\n    });\n    this._cosine = new Oscillator({\n      context: this.context,\n      phase: -90,\n      type: \"sine\"\n    });\n    this._sineMultiply = new Multiply({\n      context: this.context\n    });\n    this._cosineMultiply = new Multiply({\n      context: this.context\n    });\n    this._negate = new Negate({\n      context: this.context\n    });\n    this._add = new Add({\n      context: this.context\n    });\n    this._phaseShifter = new PhaseShiftAllpass({\n      context: this.context\n    });\n    this.effectSend.connect(this._phaseShifter); // connect the carrier frequency signal to the two oscillators\n\n    this.frequency.fan(this._sine.frequency, this._cosine.frequency);\n\n    this._phaseShifter.offset90.connect(this._cosineMultiply);\n\n    this._cosine.connect(this._cosineMultiply.factor);\n\n    this._phaseShifter.connect(this._sineMultiply);\n\n    this._sine.connect(this._sineMultiply.factor);\n\n    this._sineMultiply.connect(this._negate);\n\n    this._cosineMultiply.connect(this._add);\n\n    this._negate.connect(this._add.addend);\n\n    this._add.connect(this.effectReturn); // start the oscillators at the same time\n\n\n    const now = this.immediate();\n\n    this._sine.start(now);\n\n    this._cosine.start(now);\n  }\n\n  static getDefaults() {\n    return Object.assign(Effect.getDefaults(), {\n      frequency: 0\n    });\n  }\n\n  dispose() {\n    super.dispose();\n    this.frequency.dispose();\n\n    this._add.dispose();\n\n    this._cosine.dispose();\n\n    this._cosineMultiply.dispose();\n\n    this._negate.dispose();\n\n    this._phaseShifter.dispose();\n\n    this._sine.dispose();\n\n    this._sineMultiply.dispose();\n\n    return this;\n  }\n\n}","map":{"version":3,"sources":["../../../Tone/effect/FrequencyShifter.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["import { PhaseShiftAllpass } from \"../component/filter/PhaseShiftAllpass\";\nimport { optionsFromArguments } from \"../core/util/Defaults\";\nimport { Effect } from \"../effect/Effect\";\nimport { Add } from \"../signal/Add\";\nimport { Multiply } from \"../signal/Multiply\";\nimport { Negate } from \"../signal/Negate\";\nimport { Signal } from \"../signal/Signal\";\nimport { Oscillator } from \"../source/oscillator/Oscillator\";\nimport { ToneOscillatorNode } from \"../source/oscillator/ToneOscillatorNode\";\n/**\n * FrequencyShifter can be used to shift all frequencies of a signal by a fixed amount.\n * The amount can be changed at audio rate and the effect is applied in real time.\n * The frequency shifting is implemented with a technique called single side band modulation using a ring modulator.\n * Note: Contrary to pitch shifting, all frequencies are shifted by the same amount,\n * destroying the harmonic relationship between them. This leads to the classic ring modulator timbre distortion.\n * The algorithm will produces some aliasing towards the high end, especially if your source material\n * contains a lot of high frequencies. Unfortunatelly the webaudio API does not support resampling\n * buffers in real time, so it is not possible to fix it properly. Depending on the use case it might\n * be an option to low pass filter your input before frequency shifting it to get ride of the aliasing.\n * You can find a very detailed description of the algorithm here: https://larzeitlin.github.io/RMFS/\n *\n * @example\n * const input = new Tone.Oscillator(230, \"sawtooth\").start();\n * const shift = new Tone.FrequencyShifter(42).toDestination();\n * input.connect(shift);\n * @category Effect\n */\nexport class FrequencyShifter extends Effect {\n    constructor() {\n        super(optionsFromArguments(FrequencyShifter.getDefaults(), arguments, [\"frequency\"]));\n        this.name = \"FrequencyShifter\";\n        const options = optionsFromArguments(FrequencyShifter.getDefaults(), arguments, [\"frequency\"]);\n        this.frequency = new Signal({\n            context: this.context,\n            units: \"frequency\",\n            value: options.frequency,\n            minValue: -this.context.sampleRate / 2,\n            maxValue: this.context.sampleRate / 2,\n        });\n        this._sine = new ToneOscillatorNode({\n            context: this.context,\n            type: \"sine\",\n        });\n        this._cosine = new Oscillator({\n            context: this.context,\n            phase: -90,\n            type: \"sine\",\n        });\n        this._sineMultiply = new Multiply({ context: this.context });\n        this._cosineMultiply = new Multiply({ context: this.context });\n        this._negate = new Negate({ context: this.context });\n        this._add = new Add({ context: this.context });\n        this._phaseShifter = new PhaseShiftAllpass({ context: this.context });\n        this.effectSend.connect(this._phaseShifter);\n        // connect the carrier frequency signal to the two oscillators\n        this.frequency.fan(this._sine.frequency, this._cosine.frequency);\n        this._phaseShifter.offset90.connect(this._cosineMultiply);\n        this._cosine.connect(this._cosineMultiply.factor);\n        this._phaseShifter.connect(this._sineMultiply);\n        this._sine.connect(this._sineMultiply.factor);\n        this._sineMultiply.connect(this._negate);\n        this._cosineMultiply.connect(this._add);\n        this._negate.connect(this._add.addend);\n        this._add.connect(this.effectReturn);\n        // start the oscillators at the same time\n        const now = this.immediate();\n        this._sine.start(now);\n        this._cosine.start(now);\n    }\n    static getDefaults() {\n        return Object.assign(Effect.getDefaults(), {\n            frequency: 0,\n        });\n    }\n    dispose() {\n        super.dispose();\n        this.frequency.dispose();\n        this._add.dispose();\n        this._cosine.dispose();\n        this._cosineMultiply.dispose();\n        this._negate.dispose();\n        this._phaseShifter.dispose();\n        this._sine.dispose();\n        this._sineMultiply.dispose();\n        return this;\n    }\n}\n//# sourceMappingURL=FrequencyShifter.js.map"]},"metadata":{},"sourceType":"module"}